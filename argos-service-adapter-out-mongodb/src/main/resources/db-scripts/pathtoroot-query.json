use test;
db.getCollection("labels").aggregate(
[
{
"$match": {
"labelId": "5e32e9bc058a273b0a601169"
}
},
{
"$graphLookup": {
"from": "labels",
"startWith": "$parentLabelId",
"connectFromField": "parentLabelId",
"connectToField": "labelId",
"as": "pathToRoot",
"depthField": "depthField"
}
},
{"$unwind": "$pathToRoot"},
{"$sort": {"pathToRoot.depthField": 1
}
},
{
"$group": {_id: '$_id', "labelId": {"$first": "$labelId"}, "name": {"$first": "$name"},"pathToRoot": {"$push": "$pathToRoot.name"}}},
{
"$project": {
"labelId": 1,
"pathToRoot":1,
"pathToRootIncluding": {
"$concatArrays": [["$name"], "$pathToRoot"] }
}
}
],
{
"allowDiskUse": false
}
);
