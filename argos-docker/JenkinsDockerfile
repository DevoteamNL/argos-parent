FROM rabobanknl/argos-jenkins-base:latest

USER root
    
# Install Docker
RUN apk add --no-cache docker

# groovy files
COPY jenkins_config/*.groovy /usr/share/jenkins/ref/init.groovy.d/

# temporary patch to enable file url's
# A PR is made to upstream
RUN sed -i -e 's/http\.\+/\(http\|file\)\.\+/g' /usr/local/bin/install-plugins.sh

COPY target/lib/argos.hpi /argos.hpi
COPY jenkins_config/list-of-plugins.txt /list-of-plugins.txt

RUN /usr/local/bin/install-plugins.sh $(cat /list-of-plugins.txt)
